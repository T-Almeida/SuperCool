<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js - platformer demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>

<div id="container"></div>
<script src="threejs/three.js"></script>
<script src="threejs/PointerLockControls.js"></script>

<script src="simple_player_movement.js"></script>
<script src="scene.js"></script>

<script>



    var container = document.getElementById("container");

    var controlsEnabled = false;

    var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

    if ( havePointerLock ) {

        var element = document.body;

        var pointerlockchange = function ( event ) {

            if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {

                controlsEnabled = true;
                controls.enabled = true;


            } else {

                controls.enabled = false;

                container.style.display = '-webkit-box';
                container.style.display = '-moz-box';
                container.style.display = 'box';

            }

        };

        // Hook pointer lock state change events
        document.addEventListener( 'pointerlockchange', pointerlockchange, false );
        document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );
        document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );


        container.addEventListener( 'click', function ( event ) {

            // Ask the browser to lock the pointer
            element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;
            element.requestPointerLock();

        }, false );

    } else {

        container.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';

    }


    // resize

    var gameViewportSize = function() { return {
        width: window.innerWidth, height: window.innerHeight
    }};

    var resize = function() {
        var viewport = gameViewportSize();
        renderer.setSize( viewport.width, viewport.height );
        camera.aspect = viewport.width / viewport.height;
        camera.updateProjectionMatrix();
    };

    window.addEventListener( 'resize', resize, false );
    resize();

    // game systems code
    function resetPlayer() {
        if( controls.getObject().position.y < -123 ) {
            controls.getObject().position.set( -2, 40, 25 );
            velocity.multiplyScalar( 0 );
        }
    }

    document.getElementById( 'container' ).appendChild( renderer.domElement );

    var pause = false;


    function animate() {
        resetPlayer();
        if (!pause ) {
            movement();
        }
        requestAnimationFrame( animate );
        renderer.render( scene, camera );

    }




    keybiding();
    animate();

</script>
</body>
</html>